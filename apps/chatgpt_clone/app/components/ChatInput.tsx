'use client';

import { useRef, useEffect, useState } from 'react';
import { GoPlus } from 'react-icons/go';
import { HiOutlineAdjustmentsHorizontal } from 'react-icons/hi2'; // This icon is imported but not used in the provided code.
import { FiMic } from 'react-icons/fi';
import { RiVoiceprintFill } from 'react-icons/ri';
import { FaArrowUp } from 'react-icons/fa';
import FileUpload from './FileUpload'; // Ensure this path is correct

export default function ChatInput({
  input,
  onChange,
  onSubmit,
  isLoading,
}: any) {
  const textareaRef = useRef<HTMLTextAreaElement>(null);
  const [showAddFilesMenu, setShowAddFilesMenu] = useState(false);
  const [showFileUploadModal, setShowFileUploadModal] = useState(false); // State to control FileUpload component rendering
  const [showAddTool, setShowAddTool] = useState(false); // State for the tools dropdown

  // Effect to adjust textarea height as input changes
  useEffect(() => {
    if (textareaRef.current) {
      textareaRef.current.style.height = 'auto'; // Reset height
      textareaRef.current.style.height = `${textareaRef.current.scrollHeight}px`; // Set to scroll height
    }
  }, [input]);

  // Handle Enter key for submission, Shift + Enter for new line
  const handleKeyDown = (e: React.KeyboardEvent<HTMLTextAreaElement>) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault(); // Prevent default new line
      onSubmit(e); // Submit the form
    }
  };

  // Toggle visibility of the "Add files" dropdown menu
  const toggleAddFilesMenu = () => {
    setShowAddFilesMenu(prev => !prev);
    // Close other menus if open to ensure only one dropdown is open at a time
    setShowAddTool(false);
  };

  // Handler for clicking "Add photos and files"
  const handleAddPhotosAndFilesClick = () => {
    setShowAddFilesMenu(false); // Close the "Add files" dropdown
    setShowFileUploadModal(true); // Show the FileUpload modal (which triggers the file picker)
  };

  // Toggle visibility of the "Tools" dropdown menu
  const toggleShowAddTool = () => {
    setShowAddTool(prev => !prev);
    // Close other menus if open
    setShowAddFilesMenu(false);
  };

  // Function to handle closing the FileUpload modal
  // This is passed as a prop to FileUpload and is called when a file is selected or the dialog is cancelled.
  const handleCloseFileUploadModal = () => {
    setShowFileUploadModal(false); // Hide the FileUpload modal, ensuring it's unmounted
  };

  return (
    <div className='bottom-0 left-65 w-319 border-gray-200 bg-[#262626]'>
      <form
        onSubmit={onSubmit}
        className='mx-auto max-w-3xl w-full px-4 py-4 flex items-end gap-3'
      >
        <div className='relative flex-1 bg-[#333333] px-6 pt-4 pb-3 rounded-3xl'>
          {/* Conditional rendering for the 'Add files' dropdown menu */}
          {showAddFilesMenu && (
            <div
              className='absolute bottom-[50%] left-[20px] max-w-[250px] bg-[#333333] shadow-lg rounded-2xl border border-[#444444] p-3 transition-colors z-10 mb-2'
              id='add files'
            >
              {/* Option: Add from apps */}
              <div className='flex items-center text-sm gap-1 text-white hover:bg-[#595959] p-1 m-1 rounded-xl cursor-pointer'>
                <svg
                  width='20'
                  height='20'
                  viewBox='0 0 20 20'
                  fill='currentColor'
                  xmlns='http://www.w3.org/2000/svg'
                  className='icon'
                  aria-hidden='true'
                >
                  <path d='M7.94556 14.0277C7.94550 12.9376 7.06204 12.0540 5.97192 12.0540C4.88191 12.0542 3.99835 12.9376 3.99829 14.0277C3.99829 15.1177 4.88188 16.0012 5.97192 16.0013C7.06207 16.0013 7.94556 15.1178 7.94556 14.0277ZM13.3625 16.6663V14.6927H11.3889C11.0216 14.6927 10.7239 14.3949 10.7239 14.0277C10.7239 13.6605 11.0217 13.3626 11.3889 13.3626H13.3625V11.389C13.3625 11.0218 13.6604 10.7240 14.0276 10.7240C14.3949 10.7240 14.6926 11.0217 14.6926 11.389V13.3626H16.6663L16.8010 13.3763C17.1038 13.4385 17.3312 13.7065 17.3313 14.0277C17.3313 14.3489 17.1038 14.6169 16.8010 14.6790L16.6663 14.6927H14.6926V16.6663C14.6926 17.0336 14.3949 17.3314 14.0276 17.3314C13.6604 17.3313 13.3625 17.0336 13.3625 16.6663ZM7.94556 5.97201C7.94544 4.88196 7.06200 3.99837 5.97192 3.99837C4.88195 3.99849 3.99841 4.88203 3.99829 5.97201C3.99829 7.06208 4.88187 7.94552 5.97192 7.94564C7.06207 7.94564 7.94556 7.06216 7.94556 5.97201ZM16.0012 5.97201C16.0011 4.88196 15.1177 3.99837 14.0276 3.99837C12.9376 3.99843 12.0541 4.88200 12.0540 5.97201C12.0540 7.06212 12.9375 7.94558 14.0276 7.94564C15.1177 7.94564 16.0012 7.06216 16.0012 5.97201ZM9.27563 14.0277C9.27563 15.8524 7.79661 17.3314 5.97192 17.3314C4.14734 17.3313 2.66821 15.8523 2.66821 14.0277C2.66827 12.2031 4.14737 10.7241 5.97192 10.7240C7.79657 10.7240 9.27558 12.2030 9.27563 14.0277ZM9.27563 5.97201C9.27563 7.79670 7.79661 9.27572 5.97192 9.27572C4.14734 9.27560 2.66821 7.79662 2.66821 5.97201C2.66833 4.14749 4.14741 2.66841 5.97192 2.66830C7.79654 2.66830 9.27552 4.14742 9.27563 5.97201ZM17.3313 5.97201C17.3313 7.79669 15.8523 9.27572 14.0276 9.27572C12.2030 9.27566 10.7239 7.79666 10.7239 5.97201C10.7240 4.14746 12.2030 2.66836 14.0276 2.66830C15.8522 2.66830 17.3312 4.14742 17.3313 5.97201Z'></path>
                </svg>
                <p className='mr-6'>Add from apps</p>
                <svg
                  width='16'
                  height='16'
                  viewBox='0 0 16 16'
                  fill='currentColor'
                  xmlns='http://www.w3.org/2000/svg'
                  data-rtl-flip=''
                  className='icon-sm'
                >
                  <path d='M6.02925 3.02929C6.25652 2.80202 6.60803 2.77382 6.86616 2.94433L6.97065 3.02929L11.4707 7.52929C11.7304 7.78899 11.7304 8.21100 11.4707 8.47070L6.97065 12.9707C6.71095 13.2304 6.28895 13.2304 6.02925 12.9707C5.76955 12.7110 5.76955 12.2890 6.02925 12.0293L10.0585 7.99999L6.02925 3.97070L5.94429 3.86620C5.77378 3.60807 5.80198 3.25656 6.02925 3.02929Z'></path>
                </svg>
              </div>
              {/* Option: Add photos and files - directly calls handleAddPhotosAndFilesClick */}
              <div
                className='text-sm flex items-center gap-1 hover:bg-[#595959] p-1 rounded-2xl px-2 cursor-pointer'
                onClick={handleAddPhotosAndFilesClick}
              >
                <svg
                  width='20'
                  height='20'
                  viewBox='0 0 20 20'
                  fill='currentColor'
                  xmlns='http://www.w3.org/2000/svg'
                  className='icon'
                  aria-hidden='true'
                >
                  <path d='M14.3352 17.5003V15.6654H12.5002C12.1331 15.6654 11.8354 15.3674 11.8352 15.0003C11.8352 14.6331 12.1330 14.3353 12.5002 14.3353H14.3352V12.5003C14.3352 12.1331 14.6330 11.8353 15.0002 11.8353C15.3674 11.8355 15.6653 12.1332 15.6653 12.5003V14.3353H17.5002L17.6340 14.3490C17.9370 14.4110 18.1653 14.6790 18.1653 15.0003C18.1651 15.3215 17.9369 15.5897 17.6340 15.6517L17.5002 15.6654H15.6653V17.5003C15.6651 17.8673 15.3673 18.1652 15.0002 18.1654C14.6331 18.1654 14.3354 17.8674 14.3352 17.5003ZM16.0012 8.33333V7.33333C16.0012 6.62229 16.0013 6.12896 15.9700 5.74544C15.9469 5.46349 15.9091 5.27398 15.8577 5.13020L15.8020 5.00032C15.6481 4.69821 15.4137 4.44519 15.1262 4.26888L14.9993 4.19856C14.8413 4.11811 14.6297 4.06128 14.2542 4.03059C13.8707 3.99928 13.3772 3.99837 12.6663 3.99837H9.16431C9.16438 4.04639 9.15951 4.09505 9.14868 4.14388L8.61646 4.02571H8.61548L9.14868 4.14388L8.69263 6.19954C8.58740 6.67309 8.50752 7.06283 8.33911 7.39290L8.26196 7.53059C8.12314 7.75262 7.94729 7.94837 7.74341 8.11067L7.53052 8.26204C7.26187 8.42999 6.95158 8.52024 6.58521 8.60579L6.19946 8.69270L4.14380 9.14876L4.02564 8.61556V8.61653L4.14380 9.14876C4.09497 9.15959 4.04631 9.16446 3.99829 9.16438V12.6663C3.99829 13.3772 3.99920 13.8707 4.03052 14.2542C4.06120 14.6298 4.11803 14.8413 4.19849 14.9993L4.26880 15.1263C4.44511 15.4137 4.69813 15.6481 5.00024 15.8021L5.13013 15.8577C5.27390 15.9092 5.46341 15.9470 5.74536 15.9700C6.12888 16.0014 6.62221 16.0013 7.33325 16.0013H8.28442C8.65158 16.0013 8.94929 16.2992 8.94946 16.6663C8.94946 17.0336 8.65169 17.3314 8.28442 17.3314H7.33325C6.64416 17.3314 6.08720 17.3320 5.63696 17.2952C5.23642 17.2625 4.87552 17.1982 4.53931 17.0540L4.39673 16.9866C3.87561 16.7211 3.43911 16.3174 3.13501 15.8216L3.01294 15.6038C2.82097 15.2271 2.74177 14.8206 2.70435 14.3626C2.66758 13.9124 2.66821 13.3553 2.66821 12.6663V9.00032C2.66821 7.44077 3.58925 5.86261 4.76196 4.70638C5.93310 3.55172 7.50845 2.66750 9.00024 2.66927V2.66829H12.6663C13.3553 2.66829 13.9123 2.66765 14.3625 2.70442C14.8206 2.74184 15.2270 2.82105 15.6038 3.01302L15.8215 3.13509C16.3174 3.43919 16.7211 3.87569 16.9866 4.39681L17.0530 4.53938C17.1973 4.87570 17.2624 5.23636 17.2952 5.63704C17.3320 6.08728 17.3313 6.64424 17.3313 7.33333V8.33333C17.3313 8.70060 17.0335 8.99837 16.6663 8.99837C16.2991 8.99819 16.0012 8.70049 16.0012 8.33333ZM7.76001 4.26204C7.06176 4.53903 6.33620 5.02201 5.69556 5.65364C5.04212 6.29794 4.53764 7.03653 4.25415 7.76204L5.91138 7.39388L6.30689 7.30403C6.62563 7.22833 6.73681 7.18952 6.82544 7.13411L6.91528 7.07063C7.00136 7.00214 7.07542 6.91924 7.13403 6.82552L7.18579 6.72200C7.23608 6.59782 7.28758 6.38943 7.39380 5.91145L7.76001 4.26204Z'></path>
                </svg>
                Add photos and files
              </div>
            </div>
          )}

          {/* Conditional rendering for the 'Tools' dropdown menu */}
          {showAddTool && (
            <div className='absolute bottom-[50%] right-[500px] max-w-[300px] bg-[#333333] shadow-lg rounded-2xl border border-[#444444] p-3 transition-colors z-10 mb-2'>
              <div className='flex items-center text-sm gap-1 text-white hover:bg-[#595959] p-1 m-1 rounded-xl cursor-pointer'>
                <svg
                  width='20'
                  height='20'
                  viewBox='0 0 20 20'
                  fill='currentColor'
                  xmlns='http://www.w3.org/2000/svg'
                  className='icon'
                  aria-label=''
                >
                  <path d='M15.5707 2.18424C16.2172 1.91495 16.9523 2.08245 17.435 2.5651L17.5268 2.66568C17.9375 3.14611 18.0672 3.826 17.8159 4.42936L17.7563 4.55729C17.0247 5.96929 16.1512 7.19856 15.0952 8.3024C16.1595 9.60343 16.9544 10.9444 17.2817 12.194C17.6271 13.513 17.4625 14.8113 16.4604 15.7526L16.2495 15.9362C15.3041 16.6925 14.2397 16.5972 13.3676 16.237C12.5149 15.8847 11.7507 15.2494 11.2192 14.736C10.9554 14.4808 10.9486 14.0606 11.2036 13.7965C11.4587 13.5324 11.8788 13.5249 12.1430 13.7799C12.6320 14.2522 13.2530 14.7503 13.8754 15.0075C14.4786 15.2566 14.9814 15.2476 15.4184 14.8981L15.5356 14.7965C16.0972 14.2758 16.2587 13.5358 15.9955 12.5309C15.7402 11.5560 15.0942 10.4153 14.1352 9.22721C13.6183 9.68612 13.0635 10.1247 12.4653 10.5446L12.3276 10.3483V10.3493L12.4653 10.5446C12.4206 10.5759 12.3723 10.5979 12.3237 10.6169C12.2889 11.2362 12.0961 11.7532 11.7455 12.1569C11.3661 12.5938 10.8613 12.8333 10.3657 12.9684C9.41524 13.2274 8.24067 13.1569 7.50824 13.1569C7.14097 13.1569 6.84320 12.8591 6.84320 12.4919C6.84319 11.7594 6.77269 10.5849 7.03168 9.63443C7.16676 9.13878 7.40626 8.63402 7.84320 8.25455C8.24673 7.90413 8.76328 7.71035 9.38226 7.67545C9.40122 7.62702 9.42432 7.57929 9.45551 7.53482C9.82484 7.00868 10.2088 6.51626 10.6078 6.05338C8.18682 4.65714 5.77692 4.65583 4.43597 5.83951L4.30121 5.96744C3.44402 6.82463 3.12263 8.16037 3.41547 9.72232C3.70763 11.2805 4.60535 12.9913 6.06879 14.4547L6.39594 14.7672C7.16606 15.4689 7.96602 15.9748 8.63617 16.3131C9.01862 16.5062 9.35331 16.6421 9.60883 16.7282C9.75074 16.7760 9.85238 16.8021 9.91644 16.8171L10.0004 16.8356L10.1342 16.8483C10.4374 16.9102 10.6655 17.1792 10.6655 17.5006C10.6653 17.8219 10.4372 18.0901 10.1342 18.1520L10.0004 18.1657L9.81976 18.1510C9.62747 18.1242 9.40328 18.0615 9.18500 17.9879C8.86510 17.8802 8.47125 17.7191 8.03656 17.4997C7.27643 17.1159 6.37221 16.5450 5.49945 15.7497L5.12836 15.3952C3.50015 13.7670 2.45549 11.8215 2.10785 9.96744C1.76097 8.11721 2.10269 6.28511 3.36078 5.02701L3.55902 4.83951C5.56925 3.05673 8.80260 3.38710 11.5366 5.05924C12.6813 3.93293 13.9621 3.01097 15.4428 2.24381L15.5707 2.18424ZM9.58734 8.99869C9.13310 8.99870 8.87630 9.11869 8.71527 9.25846C8.54385 9.40733 8.40833 9.64114 8.31488 9.98404C8.16637 10.5290 8.16105 11.1743 8.16742 11.8327C8.82581 11.8390 9.47111 11.8337 10.0161 11.6852C10.3590 11.5918 10.5928 11.4563 10.7416 11.2848C10.8814 11.1238 11.0014 10.8670 11.0014 10.4128C11.0014 9.63161 10.3685 8.99869 9.58734 8.99869ZM16.4946 3.50650C16.3821 3.39404 16.2306 3.36368 16.1059 3.40396L16.0551 3.42447C13.9314 4.52482 12.2583 5.96237 10.7944 7.95084C11.3392 8.21844 11.7804 8.66010 12.0483 9.20475C14.0368 7.74085 15.4753 6.06968 16.5756 3.94596L16.5971 3.89420C16.6315 3.78742 16.6139 3.66095 16.5375 3.55631L16.4946 3.50650Z'></path>
                </svg>
                Create an image
              </div>
              <div className='flex items-center text-sm gap-1 text-white hover:bg-[#595959] p-1 m-1 rounded-xl cursor-pointer'>
                <svg
                  width='20'
                  height='20'
                  viewBox='0 0 20 20'
                  fill='currentColor'
                  xmlns='http://www.w3.org/2000/svg'
                  className='icon'
                  aria-label=''
                >
                  <path d='M10 2.125C14.3492 2.125 17.875 5.65076 17.875 10C17.875 14.3492 14.3492 17.875 10 17.875C5.65076 17.875 2.125 14.3492 2.125 10C2.125 5.65076 5.65076 2.125 10 2.125ZM7.88672 10.625C7.94334 12.3161 8.22547 13.8134 8.63965 14.9053C8.87263 15.5194 9.13510 15.9733 9.39453 16.2627C9.65437 16.5524 9.86039 16.6250 10 16.6250C10.1396 16.6250 10.3456 16.5524 10.6055 16.2627C10.8649 15.9733 11.1274 15.5194 11.3604 14.9053C11.7745 13.8134 12.0567 12.3161 12.1133 10.6250H7.88672ZM3.40527 10.6250C3.65313 13.2734 5.45957 15.4667 7.89844 16.2822C7.74090 15.9970 7.59770 15.6834 7.47070 15.3486C6.99415 14.0923 6.69362 12.4390 6.63672 10.6250H3.40527ZM13.3633 10.6250C13.3064 12.4390 13.0059 14.0923 12.5293 15.3486C12.4022 15.6836 12.2582 15.9969 12.1006 16.2822C14.5399 15.4670 16.3468 13.2737 16.5947 10.6250H13.3633ZM12.1006 3.71680C12.2584 4.00235 12.4021 4.31613 12.5293 4.65137C13.0059 5.90775 13.3064 7.56102 13.3633 9.37500H16.5947C16.3468 6.72615 14.5400 4.53199 12.1006 3.71680ZM10 3.37500C9.86039 3.37500 9.65437 3.44756 9.39453 3.73730C9.13510 4.02672 8.87263 4.48057 8.63965 5.09473C8.22547 6.18664 7.94334 7.68388 7.88672 9.37500H12.1133C12.0567 7.68388 11.7745 6.18664 11.3604 5.09473C11.1274 4.48057 10.8649 4.02672 10.6055 3.73730C10.3456 3.44756 10.1396 3.37500 10 3.37500ZM7.89844 3.71680C5.45942 4.53222 3.65314 6.72647 3.40527 9.37500H6.63672C6.69362 7.56102 6.99415 5.90775 7.47070 4.65137C7.59781 4.31629 7.74073 4.00224 7.89844 3.71680Z'></path>
                </svg>
                search the web
              </div>
              <div className='flex items-center text-sm gap-1 text-white hover:bg-[#595959] p-1 m-1 rounded-xl cursor-pointer'>
                <svg
                  width='20'
                  height='20'
                  viewBox='0 0 20 20'
                  fill='currentColor'
                  xmlns='http://www.w3.org/2000/svg'
                  className='icon'
                  aria-label=''
                >
                  <path d='M12.0303 4.11328C13.4406 2.70317 15.7275 2.70305 17.1377 4.11328C18.5474 5.52355 18.5476 7.81057 17.1377 9.22070L10.8457 15.5117C10.5220 15.8354 10.2868 16.0723 10.0547 16.2627L9.82031 16.4395C9.61539 16.5794 9.39783 16.7003 9.17090 16.7998L8.94141 16.8916C8.75976 16.9582 8.57206 17.0072 8.35547 17.0518L7.59082 17.1865L5.19727 17.5859C5.05455 17.6097 4.90286 17.6358 4.77441 17.6455C4.67576 17.6530 4.54196 17.6555 4.39648 17.6201L4.24707 17.5703C4.02415 17.4746 3.84119 17.3068 3.72559 17.0957L3.67969 17.0029C3.59322 16.8013 3.59553 16.6073 3.60547 16.4756C3.61519 16.3473 3.64030 16.1963 3.66406 16.0537L4.06348 13.6602C4.16380 13.0582 4.22517 12.6732 4.35840 12.3096L4.45117 12.0791C4.55073 11.8521 4.67152 11.6346 4.81152 11.4297L4.98730 11.1953C5.17772 10.9632 5.41460 10.7280 5.73828 10.4043L12.0303 4.11328ZM6.67871 11.3447C6.32926 11.6942 6.14542 11.8803 6.01953 12.0332L5.90918 12.1797C5.81574 12.3165 5.73539 12.4618 5.66895 12.6133L5.60742 12.7666C5.52668 12.9869 5.48332 13.2290 5.37500 13.8789L4.97656 16.2725L4.97559 16.2744H4.97852L7.37207 15.8750L8.08887 15.7490C8.25765 15.7147 8.37336 15.6839 8.48340 15.6436L8.63672 15.5811C8.78817 15.5146 8.93356 15.4342 9.07031 15.3408L9.21680 15.2305C9.36965 15.1046 9.55583 14.9207 9.90527 14.5713L14.8926 9.58301L11.6660 6.35742L6.67871 11.3447ZM16.1963 5.05371C15.3054 4.16304 13.8616 4.16305 12.9707 5.05371L12.6074 5.41602L15.8330 8.64258L16.1963 8.27930C17.0869 7.38845 17.0869 5.94456 16.1963 5.05371Z'></path>
                  <path d='M4.58301 1.78320C4.72589 1.78320 4.84877 1.88437 4.87695 2.02441C4.99384 2.60873 5.22432 3.11642 5.58398 3.50391C5.94115 3.88854 6.44253 4.17200 7.13281 4.28711C7.27713 4.31140 7.38267 4.43665 7.38281 4.58301C7.38281 4.72950 7.27723 4.85460 7.13281 4.87891C6.44249 4.99401 5.94116 5.27746 5.58398 5.66211C5.26908 6.00126 5.05404 6.43267 4.92676 6.92676L4.87695 7.14160C4.84891 7.28183 4.72601 7.38281 4.58301 7.38281C4.44013 7.38267 4.31709 7.28173 4.28906 7.14160C4.17212 6.55728 3.94179 6.04956 3.58203 5.66211C3.22483 5.27757 2.72347 4.99395 2.03320 4.87891C1.88897 4.85446 1.78320 4.72938 1.78320 4.58301C1.78335 4.43673 1.88902 4.31150 2.03320 4.28711C2.72366 4.17203 3.22481 3.88861 3.58203 3.50391C3.94186 3.11638 4.17214 2.60888 4.28906 2.02441L4.30371 1.97363C4.34801 1.86052 4.45804 1.78333 4.58301 1.78320Z'></path>
                </svg>
                Write or code
              </div>
              <div className='flex items-center text-sm gap-1 text-white hover:bg-[#595959] p-1 m-1 rounded-xl cursor-pointer'>
                <svg
                  width='20'
                  height='20'
                  viewBox='0 0 20 20'
                  fill='currentColor'
                  xmlns='http://www.w3.org/2000/svg'
                  className='icon'
                  aria-label=''
                >
                  <path d='M11.5171 11.9924C11.5171 11.1544 10.8375 10.4749 9.99951 10.4748C9.16140 10.4748 8.48194 11.1543 8.48194 11.9924C8.48204 12.8304 9.16146 13.5100 9.99951 13.5100C10.8375 13.5099 11.5170 12.8304 11.5171 11.9924ZM3.80713 8.71018C3.28699 8.92666 3.01978 9.50634 3.19385 10.0422L3.52686 11.0647L3.56494 11.1653C3.77863 11.6537 4.32351 11.9188 4.84717 11.7717L7.30322 11.0803C7.68362 9.95526 8.74606 9.14475 9.99951 9.14475C10.6946 9.14479 11.3313 9.39406 11.8257 9.80783L13.0933 9.45139L13.0278 9.28049L11.7671 5.40061L3.80713 8.71018ZM14.5962 3.05783L14.4683 3.08615L13.6382 3.35569C13.0705 3.54027 12.7594 4.15025 12.9438 4.71799L14.2935 8.86936L14.3325 8.97287C14.5537 9.47408 15.1235 9.73664 15.6558 9.56369L16.4858 9.29319L16.6050 9.24045C16.8285 9.11361 16.9562 8.86404 16.9272 8.60861L16.8999 8.48166L15.2808 3.49924C15.1844 3.20321 14.8940 3.02422 14.5962 3.05783ZM12.8472 11.9924C12.8471 12.9213 12.3997 13.7432 11.7114 14.2629L13.6187 17.3137L13.6782 17.4348C13.7863 17.7246 13.6802 18.0603 13.4077 18.2307C13.1352 18.4010 12.7869 18.3493 12.5737 18.1252L12.4907 18.0188L10.4761 14.7961C10.3209 14.8223 10.1621 14.8400 9.99951 14.8401C9.83597 14.8401 9.67603 14.8226 9.52002 14.7961L7.50635 18.0188L7.42334 18.1252C7.21015 18.3493 6.86184 18.4010 6.58936 18.2307C6.27803 18.0360 6.18380 17.6251 6.37842 17.3137L8.28467 14.2619C7.72379 13.8376 7.32535 13.2124 7.19776 12.4914L5.20752 13.0520C4.03967 13.3804 2.82407 12.7896 2.34717 11.7004L2.26221 11.4758L1.92920 10.4533C1.54076 9.25785 2.13665 7.96420 3.29737 7.48166L11.5884 4.03342C11.7179 3.15622 12.3266 2.38379 13.2271 2.09104L14.0581 1.82053L14.2524 1.76779C15.2307 1.55610 16.2295 2.11668 16.5454 3.08908L18.1646 8.07053L18.2173 8.26584C18.4145 9.17874 17.9401 10.1097 17.0855 10.4865L16.8970 10.5588L16.0659 10.8283C15.3549 11.0592 14.6144 10.9419 14.0288 10.5705L12.6499 10.9572C12.7754 11.2783 12.8472 11.6269 12.8472 11.9924Z'></path>
                </svg>
                Run deep search
              </div>
              <div className='flex items-center text-sm gap-1 text-white hover:bg-[#595959] p-1 m-1 rounded-xl cursor-pointer'>
                <svg
                  width='20'
                  height='20'
                  viewBox='0 0 20 20'
                  fill='currentColor'
                  xmlns='http://www.w3.org/2000/svg'
                  className='icon'
                  aria-label=''
                >
                  <path d='M14.3352 10.0257C14.3352 7.61430 12.3910 5.66554 10.0002 5.66537C7.60929 5.66537 5.66528 7.61419 5.66528 10.0257C5.66531 11.5493 6.44221 12.8881 7.61938 13.6683H12.3811C13.5580 12.8881 14.3352 11.5491 14.3352 10.0257ZM8.84399 16.9984C9.07459 17.3983 9.50543 17.6683 10.0002 17.6683C10.4950 17.6682 10.9260 17.3984 11.1565 16.9984H8.84399ZM8.08813 15.6683H11.9114V14.9984H8.08813V15.6683ZM1.66626 9.33529L1.80103 9.34896C2.10381 9.41116 2.33130 9.67914 2.33130 10.0003C2.33115 10.3214 2.10377 10.5896 1.80103 10.6517L1.66626 10.6654H0.833252C0.466091 10.6654 0.168389 10.3674 0.168213 10.0003C0.168213 9.63306 0.465983 9.33529 0.833252 9.33529H1.66626ZM19.1663 9.33529L19.3010 9.34896C19.6038 9.41116 19.8313 9.67914 19.8313 10.0003C19.8311 10.3214 19.6038 10.5896 19.3010 10.6517L19.1663 10.6654H18.3333C17.9661 10.6654 17.6684 10.3674 17.6682 10.0003C17.6682 9.63306 17.9660 9.33529 18.3333 9.33529H19.1663ZM3.04810 3.04818C3.27530 2.82099 3.62593 2.79189 3.88403 2.96224L3.98853 3.04818L4.57739 3.63705L4.66235 3.74154C4.83285 3.99966 4.80464 4.35021 4.57739 4.57748C4.35013 4.80474 3.99958 4.83293 3.74146 4.66244L3.63696 4.57748L3.04810 3.98861L2.96216 3.88412C2.79181 3.62601 2.82089 3.27538 3.04810 3.04818ZM16.0120 3.04818C16.2717 2.78860 16.6927 2.78852 16.9524 3.04818C17.2117 3.30786 17.2119 3.72901 16.9524 3.98861L16.3625 4.57748C16.1028 4.83717 15.6818 4.83718 15.4221 4.57748C15.1626 4.31776 15.1625 3.89669 15.4221 3.63705L16.0120 3.04818ZM9.33521 1.66634V0.833336C9.33521 0.466067 9.63297 0.168297 10.0002 0.168297C10.3674 0.168472 10.6653 0.466175 10.6653 0.833336V1.66634C10.6653 2.03350 10.3674 2.33121 10.0002 2.33138C9.63297 2.33138 9.33521 2.03361 9.33521 1.66634ZM15.6653 10.0257C15.6653 11.9571 14.7058 13.6634 13.2415 14.6917V16.3333C13.2415 16.7004 12.9444 16.9971 12.5774 16.9974C12.2820 18.1473 11.2423 18.9982 10.0002 18.9984C8.75792 18.9984 7.71646 18.1476 7.42114 16.9974C7.05476 16.9964 6.75806 16.7000 6.75806 16.3333V14.6917C5.29383 13.6634 4.33523 11.9570 4.33521 10.0257C4.33521 6.88608 6.86835 4.33529 10.0002 4.33529C13.1320 4.33547 15.6653 6.88618 15.6653 10.0257Z'></path>
                </svg>
                think for longer
              </div>
            </div>
          )}

          <textarea
            ref={textareaRef}
            rows={1}
            value={input}
            onChange={onChange}
            onKeyDown={handleKeyDown}
            placeholder='Ask anything'
            className='w-full resize-none overflow-hidden text-sm focus:outline-none focus:ring-0 bg-transparent text-white'
            style={{ maxHeight: '250px' }}
          />

          <div className='flex justify-between items-center'>
            <div className='flex items-center gap-3 text-white'>
              <GoPlus
                className='h-5 w-5 mt-1 cursor-pointer'
                onClick={toggleAddFilesMenu}
              />
              <div
                className='text-sm flex items-center gap-1 hover:bg-[#595959] p-1 rounded-2xl px-2 cursor-pointer'
                onClick={toggleShowAddTool}
              >
                <svg
                  width='20'
                  height='20'
                  viewBox='0 0 20 20'
                  fill='currentColor'
                  xmlns='http://www.w3.org/2000/svg'
                  className='icon'
                  aria-hidden='true'
                >
                  <path d='M7.91626 11.0013C9.43597 11.0013 10.7053 12.0729 11.011 13.5013H16.6663L16.801 13.515C17.1038 13.5771 17.3311 13.8453 17.3313 14.1663C17.3313 14.4875 17.1038 14.7555 16.8010 14.8177L16.6663 14.8314H11.011C10.7056 16.2601 9.43619 17.3314 7.91626 17.3314C6.39643 17.3312 5.12690 16.2601 4.82153 14.8314H3.33325C2.96598 14.8314 2.66821 14.5336 2.66821 14.1663C2.66839 13.7992 2.96609 13.5013 3.33325 13.5013H4.82153C5.12713 12.0729 6.39665 11.0015 7.91626 11.0013ZM7.91626 12.3314C6.90308 12.3316 6.08148 13.1532 6.08130 14.1663C6.08130 15.1797 6.90297 16.0011 7.91626 16.0013C8.92970 16.0013 9.75122 15.1798 9.75122 14.1663C9.75104 13.1530 8.92959 12.3314 7.91626 12.3314ZM12.0833 2.66829C13.6031 2.66829 14.8725 3.73966 15.1780 5.16829H16.6663L16.8010 5.18196C17.1038 5.24414 17.3313 5.51212 17.3313 5.83333C17.3313 6.15454 17.1038 6.42253 16.8010 6.48470L16.6663 6.49837H15.1780C14.8725 7.92701 13.6031 8.99837 12.0833 8.99837C10.5634 8.99837 9.29405 7.92701 8.98853 6.49837H3.33325C2.96598 6.49837 2.66821 6.20060 2.66821 5.83333C2.66821 5.46606 2.96598 5.16829 3.33325 5.16829H8.98853C9.29405 3.73966 10.5634 2.66829 12.0833 2.66829ZM12.0833 3.99837C11.0698 3.99837 10.2483 4.81989 10.2483 5.83333C10.2483 6.84677 11.0698 7.66829 12.0833 7.66829C13.0967 7.66829 13.9182 6.84677 13.9182 5.83333C13.9182 4.81989 13.0967 3.99837 12.0833 3.99837Z'></path>
                </svg>
                Tools
              </div>
            </div>

            <div className='flex items-center '>
              <div className='rounded-full p-3 cursor-pointer hover:bg-[#595959] transition-colors'>
                <FiMic className='text-white cursor-pointer h-5 w-5 ' />
              </div>

              {input.trim() === '' ? (
                <div className='bg-[#595959] rounded-full p-3 ml-2 cursor-pointer hover:bg-[#737373] transition-colors'>
                  <RiVoiceprintFill className='text-white w-5 h-5' />
                </div>
              ) : (
                <button
                  type='submit'
                  disabled={isLoading}
                  className='bg-white text-black rounded-full p-2 ml-2 cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed'
                >
                  <FaArrowUp />
                </button>
              )}
            </div>
          </div>
        </div>
      </form>
      {showFileUploadModal && (
        <FileUpload onClose={handleCloseFileUploadModal} />
      )}

      <div className='text-center text-xs pb-2 text-white select-none'>
        ChatGPT can make mistakes. Check important info. See{' '}
        <span className='underline'>Cookie Preferences.</span>
      </div>
    </div>
  );
}